# 研二上 kr & nirs 记录

> ORB-SLAM 还没读完，不知道做点什么好。好难。
> 尝试实现一个 ESKF VIO，加上 ego-planner 的路径规划吧，之后想想 SLAM 能怎么发论文
> 
> Dknt 2023.12

**代码要求**

1. Google 代码风格
2. 考虑向 ROS 2 移植的可能性。自己写的库，不依赖于 ROS，但提供对 ROS 的接口。接口通过继承实现。


# 2023.12.5

目前，我可以在 ROS 2 下配置 PX4 SITL，运行 ORB3。但 VINS 以及路径规划包等都依赖于 ROS 1，于是我不得不重新回到 ROS 1 中。

预计计划：

1. 稠密建图
2. VIO
3. 路径规划

其中，路径规划理论上有 odometry 数据和 depth camera 就可以运行。可以先搭建场景实验一下。

为了方便展示，需要实现稠密建图

VIO 涉及大量数学原理，目前有两种方案。第一种，松耦合方案，在现有 SLAM 框架的基础上开发 IMU ESKF； 第二种，紧耦合方案，自己开发一个完整的 VIO。我希望做第二种，但不知道时间够不够。可以先实现第一种方案，有时间的话，自己写 VIO。


任务：

1. 场景搭建

路径规划场景，需要有柱子，圆圈。

我需要一个特征丰富的室内场景，用于测试 SLAM。

还需要一个障碍物场景。

2. rt 稠密建图

3. ORB 3 + ESKF VIO

4. 自己写一个 VIO

要读别人的源码

# 2023.12.6

昨天相机显示出了点 bug，解决了。

今天尝试调试写一个 mavsdk 控制类，并调试 ego-planner

# 2023.12.8

已经完成 mavsdk 控制类

昨天写了 ORB-SLAM 2 RGBD 节点，效果很好。深度相机范围的问题要注意一下。之后再加个稠密建图，不知道 ubuntu20 下 PCL 会不会冲突。先拿高博的跑一下看。

ego-planner 调试还没有完成

赶紧弄完吧，之后仔细读读 ORB 源码、新论文，想想怎么发文章。别人看的是论文，技术能力再强能怎么样。没人在乎的，除了我自己。

# 2023.12.10

ego-planner 的控制是发送位置点，需要实现 mavsdk 位置控制。但是 mavsdk offboard mode 中的 position setpoint 还没有开发，我得自己写...

基于 action goto_position 写一个，需要传入全局 latitute, longitute, altitude, yaw angle，坐标变换有些问题。并且 local NED 和 body FRD 不完全重合。需要在类内记录初始位置、姿态。

**已解决** 类内调用位置控制时会报错，可能是由于开了太多 Callback，单写的 position_test.cc 不存在问题。

> 原因：占用了锁，导致队列满

# 2023.12.12

下个礼拜三课程设计答辩，需要快点弄完，写报告出来。

然后加个 ESKF

# 2023.12.13

修改了 ego 轨迹服务器，现在无人机可以跟踪轨迹了，存在问题如下：

1. 某些姿态有点问题，应该是轨迹服务器中的坐标变换不对。需要重新检查所有的坐标变换。轨迹服务器姿态样条线到消息，飞控消息到 flu, flu 到 ned, ned 到 Global。

2. 轨迹跟踪存在比较大的误差，应该是重规划的逻辑不对，需要修改 ego_replan_fsm 中状态机逻辑。


# 2023.12.17

姿态问题基本解决，但好像又有问题了

修改了 ego 的状态机，轨迹跟踪是一段一段的，感觉是速度的问题

